<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω sinh vi√™n</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 900px; margin-top: 30px; }
        .table-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 20px; }
        h3 { color: #333; font-weight: bold; margin-bottom: 20px; }
        h4 { color: #555; margin-top: 20px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h3>QU·∫¢N L√ù SINH VI√äN</h3>

    <!-- DANH S√ÅCH SINH VI√äN -->
    <div class="table-container">
        <div class="input-group mb-3">
            <input type="text" id="search" class="form-control"
                   placeholder="üîç T√¨m theo t√™n..." onkeyup="searchStudent()">
            <button class="btn btn-outline-secondary" onclick="loadStudents()">Reset</button>
        </div>

        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>T√™n</th>
                <th>Email</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
            </thead>
            <tbody id="studentTable"></tbody>
        </table>
    </div>

    <!-- FORM TH√äM/S·ª¨A -->
    <div class="form-container">
        <h4 id="formTitle">Th√™m sinh vi√™n</h4>
        <form id="studentForm" onsubmit="handleSubmit(event)">
            <input type="hidden" id="editId">
            
            <div class="mb-3">
                <label class="form-label">T√™n sinh vi√™n</label>
                <input type="text" id="name" class="form-control" placeholder="Nh·∫≠p t√™n..." required>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" id="email" class="form-control" placeholder="Nh·∫≠p email..." required>
            </div>
            
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary" id="submitBtn">Th√™m</button>
                <button type="button" class="btn btn-secondary" onclick="resetForm()">H·ªßy</button>
            </div>
        </form>
    </div>
</div>

<script>
const API = "https://apicrud-students-web-7.onrender.com/api/students";
// http://localhost:8080/api/students
let isEditing = false;

// Load danh s√°ch sinh vi√™n
function loadStudents() {
    fetch(API)
        .then(res => {
            if (!res.ok) throw new Error("Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server");
            return res.json();
        })
        .then(data => {
            let html = "";
            if (data.length === 0) {
                html = `<tr><td colspan="4" class="text-center text-muted">Kh√¥ng c√≥ sinh vi√™n</td></tr>`;
            } else {
                data.forEach(s => {
                    html += `
                    <tr>
                        <td><strong>${s.id}</strong></td>
                        <td>${s.name}</td>
                        <td>${s.email}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editStudent(${s.id}, '${s.name}', '${s.email}')">S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudent(${s.id})">X√≥a</button>
                        </td>
                    </tr>`;
                });
            }
            document.getElementById("studentTable").innerHTML = html;
            document.getElementById("search").value = "";
        })
        .catch(err => {
            alert("L·ªói: " + err.message);
            document.getElementById("studentTable").innerHTML = 
                `<tr><td colspan="4" class="text-center text-danger">L·ªói k·∫øt n·ªëi</td></tr>`;
        });
}

// Th√™m ho·∫∑c S·ª≠a sinh vi√™n
function handleSubmit(event) {
    event.preventDefault();
    
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    
    if (!name || !email) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin");
        return;
    }

    if (isEditing) {
        // S·ª≠a sinh vi√™n
        const id = document.getElementById("editId").value;
        fetch(`${API}/update/${id}?name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" }
        })
        .then(res => {
            if (res.ok) {
                alert("C·∫≠p nh·∫≠t th√†nh c√¥ng");
                resetForm();
                loadStudents();
            } else {
                alert(" C·∫≠p nh·∫≠t th·∫•t b·∫°i");
            }
        })
        .catch(err => alert("L·ªói: " + err.message));
    } else {
        // Th√™m sinh vi√™n
        const student = { name, email };
        
        fetch(API, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(student)
        })
        .then(res => {
            if (res.ok) {
                alert("Th√™m th√†nh c√¥ng");
                resetForm();
                loadStudents();
            } else {
                alert("Th√™m th·∫•t b·∫°i");
            }
        })
        .catch(err => alert("L·ªói: " + err.message));
    }
}

// X√≥a sinh vi√™n
function deleteStudent(id) {
    if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a sinh vi√™n n√†y?")) return;
    
    fetch(`${API}/delete/${id}`, { method: "POST" })
        .then(res => {
            if (res.ok) {
                alert(" X√≥a th√†nh c√¥ng");
                loadStudents();
            } else {
                alert(" X√≥a th·∫•t b·∫°i");
            }
        })
        .catch(err => alert("L·ªói: " + err.message));
}

// S·ª≠a sinh vi√™n (ƒëi·ªÅn d·ªØ li·ªáu v√†o form)
function editStudent(id, name, email) {
    isEditing = true;
    document.getElementById("editId").value = id;
    document.getElementById("name").value = name;
    document.getElementById("email").value = email;
    document.getElementById("formTitle").textContent = " S·ª≠a sinh vi√™n";
    document.getElementById("submitBtn").textContent = "C·∫≠p nh·∫≠t";
    document.getElementById("studentForm").scrollIntoView({ behavior: "smooth" });
}

// Reset form
function resetForm() {
    isEditing = false;
    document.getElementById("studentForm").reset();
    document.getElementById("editId").value = "";
    document.getElementById("formTitle").textContent = " Th√™m sinh vi√™n";
    document.getElementById("submitBtn").textContent = "Th√™m";
}

// T√¨m ki·∫øm sinh vi√™n
function searchStudent() {
    const name = document.getElementById("search").value.trim();
    
    if (!name) {
        loadStudents();
        return;
    }

    fetch(`${API}/search?name=${encodeURIComponent(name)}`)
        .then(res => {
            if (!res.ok) throw new Error("T√¨m ki·∫øm th·∫•t b·∫°i");
            return res.json();
        })
        .then(data => {
            let html = "";
            if (data.length === 0) {
                html = `<tr><td colspan="4" class="text-center text-muted">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</td></tr>`;
            } else {
                data.forEach(s => {
                    html += `
                    <tr>
                        <td><strong>${s.id}</strong></td>
                        <td>${s.name}</td>
                        <td>${s.email}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editStudent(${s.id}, '${s.name}', '${s.email}')">S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudent(${s.id})">X√≥a</button>
                        </td>
                    </tr>`;
                });
            }
            document.getElementById("studentTable").innerHTML = html;
        })
        .catch(err => alert("L·ªói: " + err.message));
}

// Load d·ªØ li·ªáu khi trang t·∫£i
loadStudents();
</script>

</body>
</html>